---
title: 'Планировщик Go'
description: 'Детальный разбор работы планировщика Go: модель G-M-P, work stealing и вытеснение.'
category: 'Golang'
date: '2026-02-02'
---

Планировщик Go — это компонент рантайма, который управляет выполнением горутин, обеспечивая их распределение по доступным потокам операционной системы. Его цель — эффективно использовать многоядерные процессоры.

## Основные компоненты (GMP)

1. **G (Goroutine)**:
    - Легковесная абстракция потока. Имеет свой стек, счетчик команд и другую информацию.
2. **M (Machine)**:
    - Поток ОС. Ответственен за выполнение кода.
3. **P (Processor)**:
    - Логический процессор. Содержит очередь готовых к выполнению горутин (run queue). Связывает G и M.
    - Количество P задается `GOMAXPROCS`.

## Принципы работы

- **Work Stealing**: Если у P заканчиваются горутины, он пытается украсть половину очереди у другого P.
- **System Calls**: Когда M блокируется на системном вызове, P отцепляется от него и может быть захвачен другим свободным M (или создается новый M) для выполнения других горутин.
- **Preemption (Вытеснение)**:
  - Чтобы одна горутина не захватила процессор надолго, планировщик использует вытеснение (preemption).
  - Раньше вытеснение происходило только на вызовах функций (через проверки в стеке).
  - Начиная с Go 1.14, появилось асинхронное вытеснение (asynchronous preemption) на основе сигналов, позволяющее прерывать даже плотные циклы.

## Низкоуровневые функции

- **`gopark`**: Приостановить горутину (перевод в waiting).
- **`goready`**: Разбудить горутину (перевод в runnable).
- **`gosched`**: Уступить место в очереди.
- **`entersyscall` / `exitsyscall`**: Обработка системных вызовов.
